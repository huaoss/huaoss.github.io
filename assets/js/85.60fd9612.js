(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{351:function(t,e,n){"use strict";n.r(e);var s=n(13),o=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"微信小程序踩坑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序踩坑"}},[t._v("#")]),t._v(" 微信小程序踩坑")]),t._v(" "),e("h2",{attrs:{id:"wx-switchtab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wx-switchtab"}},[t._v("#")]),t._v(" wx.switchTab")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("不能query传参数\t\n解决：使用全局变量或缓存传参")])]),t._v(" "),e("li",[e("p",[t._v("不能触发onlaod")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("  wx.switchTab({\n    url: '/pages/index/index',\n    success: function (e) {\n        var page = getCurrentPages().pop();\n        if (page == undefined || page == null) return;\n        page.onLoad();\n    }\n  })\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"长按与点击事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#长按与点击事件"}},[t._v("#")]),t._v(" 长按与点击事件")]),t._v(" "),e("ul",[e("li",[t._v("点击：touchstart → touchend → tap")]),t._v(" "),e("li",[t._v("长按 touchstart → longtap → touchend → tap")])]),t._v(" "),e("h2",{attrs:{id:"websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" webSocket")]),t._v(" "),e("ol",[e("li",[t._v("获取局部网络的地址IP 加上 ws:// 和 3001")])]),t._v(" "),e("blockquote",[e("p",[t._v("ws://199.213.7.102:3001")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("建立客户端和服务器的链接，并且发送消息，监听服务器回发消息")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(' // wxml\n <input type="tex" bindchange="sendMessage" class="text" placeholder="请输入消息"></input>\n \n // js\n //本地服务器地址\n var wsApi = "ws://199.213.7.102:3001";\n var socketOpen==false;\n \n sendMessage:function(e){\n \tvar msg=e.detail.value;\n \tif (socketOpen) {\n \t\tconsole.log(msg);\n \t\t//向服务器发送消息\n \t\twx.sendSocketMessage({\n \t\t\tdata: msg\n \t\t})\n \t}\n },\n \n onLoad: function (options) {\n \t//建立连接\n \twx.connectSocket({\n \t\turl: wsApi,\n \t\theader: {\n \t\t \'content-type\': \'application/json\'\n \t\t},\n \t\t//method:"GET",\n \t\tprotocols: [\'protocol1\'],\n \t\tsuccess: function () {\n \t\t\tconsole.log("客户端连接成功！");\n \t\t \twx.onSocketOpen(function(){\n \t\t  \t\tconsole.log(\'webSocket已打开！\');\n \t\t  \t\tsocketOpen=true;\n \t\t\t  \twx.onSocketMessage(function(msg){\n \t\t\t   \t\tconsole.log(msg);\n \t\t\t  \t})\n \t\t \t})\n \t\t}\n \t})\n },\n')])])])]),t._v(" "),e("li",[e("p",[t._v("服务器端使用nodejs配置")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("新建 websocket 文件夹，"),e("code",[t._v("cd websocket`` npm install ws")]),t._v("\t建立环境")])]),t._v(" "),e("li",[e("p",[t._v("文件夹下创建 server.js 用来编写 nodejs 代码")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(' //引入ws模块的构造函数\n var webSocketServer=require("ws").Server;\n \n //实例化\n var wss=new webSocketServer({\n \tport:3001\n });\n \n //监听客户端连接\n wss.on("connection",function(ws){\n     console.log("服务器连接建立成功");\n     \n     //监听客户端消息\n     ws.on("message",function(msg){\n         console.log(msg);\n         \n         // 回发消息\n         ws.send("来自客户端的消息："+msg);\n     })\n });\n')])])])])])]),t._v(" "),e("li",[e("p",[t._v("演示websocket")]),t._v(" "),e("ol",[e("li",[e("code",[t._v("node server.js")]),t._v(" 运行server.js代码")]),t._v(" "),e("li",[t._v("小程序中输入消息")])])])]),t._v(" "),e("p",[t._v("// 手写原生小程序瀑布流")]),t._v(" "),e("p",[t._v("var query;")]),t._v(" "),e("p",[t._v("async isLeft() {\nconst { list, leftList, rightList } = this.data;\nquery = wx.createSelectorQuery();\nfor (const item of list) {\nleftHeight <= rightHeight ? leftList.push(item) : rightList.push(item); //判断两边高度，来觉得添加到那边\nawait this.getBoxHeight(leftList, rightList);\n}\n}")]),t._v(" "),e("p",[t._v("//获取左右两边高度\ngetBoxHeight(leftList, rightList) {\nreturn new Promise((resolve, reject) => {\nthis.setData({ leftList, rightList }, () => {\nquery.select('#left').boundingClientRect();\nquery.select('#right').boundingClientRect();\nquery.exec((res) => {\nleftHeight = res[0].height; //获取左边列表的高度\nrightHeight = res[1].height; //获取右边列表的高度\nresolve();\n});\n});\n})\n}")])])}),[],!1,null,null,null);e.default=o.exports}}]);